sudo: required
dist: trusty

env:
  - ANSIBLE_HOST_KEY_CHECKING=False

notifications:
  email: false

before_install:
  - openssl aes-256-cbc -K $encrypted_732124946efe_key -iv $encrypted_732124946efe_iv -in deploy/deploy-key.enc -out deploy/deploy-key -d
  - sudo apt-add-repository ppa:ansible/ansible -y
  - sudo apt-get -qq update
  - sudo apt-get install software-properties-common
  - sudo apt-get install ansible
  - sudo apt-get install python-software-properties
  - curl -sL https://deb.nodesource.com/setup_7.x | sudo -E bash -
  - sudo apt-get install nodejs
  - sudo npm install
  - sudo npm run build
  - cd build && sudo python -m SimpleHTTPServer 8000 &
  - sleep 5
  - curl http://127.0.0.1:8000
  - ps aux | grep python
  - npm test

language: javascript

script:
  - chmod 600 deploy/deploy-key
  - ansible-playbook deploy/deploy.yml -i deploy/hosts -vvvv --private-key deploy/deploy-key
